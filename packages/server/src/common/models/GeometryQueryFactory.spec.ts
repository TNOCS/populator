import { CircleFeatureDto } from '../dtos/CircleFeature.dto';
import { GeometryQueryFactory } from './GeometryQueryFactory';
import { FeatureDto } from '../dtos/Feature.dto';

describe('Geometry query factory tests', () => {
  const gqf = new GeometryQueryFactory();
  const circleFeature = {
    type: 'Feature',
    properties: {
      shape: 'Circle',
      radius: 100,
    },
    geometry: {
      type: 'Point',
      coordinates: [4.683419913053513, 51.7867934354102],
    },
  } as CircleFeatureDto;

  const polygonFeature = {
    type: 'Feature',
    properties: {},
    geometry: {
      type: 'Polygon',
      coordinates: [
        [
          [4.720172882080078, 51.817210992860566],
          [4.716224670410156, 51.817104876426534],
          [4.711418151855469, 51.816998759742575],
          [4.7055816650390625, 51.816255935957535],
          [4.698543548583984, 51.81466412946878],
          [4.692192077636718, 51.81275388745832],
          [4.684638977050781, 51.81031290483142],
          [4.680004119873046, 51.807977928172875],
          [4.677085876464843, 51.805112109674475],
          [4.67365264892578, 51.80150304201449],
          [4.67365264892578, 51.797999847094694],
          [4.674510955810547, 51.7942840398936],
          [4.679489135742187, 51.792479108773435],
          [4.684638977050781, 51.79194823293156],
          [4.691162109375, 51.79205440859987],
          [4.694938659667969, 51.79300997836633],
          [4.703178405761719, 51.79513339424869],
          [4.707984924316406, 51.797575198911495],
          [4.712276458740234, 51.8003353406177],
          [4.717769622802734, 51.80405064917853],
          [4.720172882080078, 51.80670425355611],
          [4.722404479980468, 51.80999450604626],
          [4.723606109619141, 51.81317839268047],
          [4.723949432373047, 51.8160436983412],
          [4.720172882080078, 51.817210992860566],
        ],
      ],
    },
  } as FeatureDto;

  const actualRequiredPostgisFunctionQueryPolygon =
    "ST_Transform(ST_GeomFromText('POLYGON((4.720172882080078 51.817210992860566,4.716224670410156 51.817104876426534,4.711418151855469 51.816998759742575,4.7055816650390625 51.816255935957535,4.698543548583984 51.81466412946878,4.692192077636718 51.81275388745832,4.684638977050781 51.81031290483142,4.680004119873046 51.807977928172875,4.677085876464843 51.805112109674475,4.67365264892578 51.80150304201449,4.67365264892578 51.797999847094694,4.674510955810547 51.7942840398936,4.679489135742187 51.792479108773435,4.684638977050781 51.79194823293156,4.691162109375 51.79205440859987,4.694938659667969 51.79300997836633,4.703178405761719 51.79513339424869,4.707984924316406 51.797575198911495,4.712276458740234 51.8003353406177,4.717769622802734 51.80405064917853,4.720172882080078 51.80670425355611,4.722404479980468 51.80999450604626,4.723606109619141 51.81317839268047,4.723949432373047 51.8160436983412,4.720172882080078 51.817210992860566))', 4326), 28992)";

  const actualRequiredPostgisFunctionQueryCircle =
    "st_buffer(ST_Transform(ST_GeomFromText('POINT(4.683419913053513 51.7867934354102)', 4326), 28992), 100)";

  it('should return the specific postgis query function for a polygon when a polygon feature is requested for analysis', async () => {
    expect(await gqf.getQuery(polygonFeature)).toBe(
      actualRequiredPostgisFunctionQueryPolygon,
    );
  });

  it('should return the specific postgis query function for a circle when a circle feature is requested for analysis', async () => {
    expect(await gqf.getQuery(circleFeature)).toBe(
      actualRequiredPostgisFunctionQueryCircle,
    );
  });
});
